<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Thời tiết Việt Nam</title>
<style>
:root {
    --bg-light: #e0f7fa;
    --bg-dark: #121212;
    --text-light: #000;
    --text-dark: #fff;
}
body { font-family: 'Segoe UI', sans-serif; margin:0; padding:0; transition:0.3s;}
body.light { background-color: var(--bg-light); color: var(--text-light); }
body.dark { background-color: var(--bg-dark); color: var(--text-dark); }

.container { max-width: 1200px; margin:0 auto; padding:20px;}
header { text-align:center; margin-bottom:20px;}
header h1 { margin-bottom:10px; }
.datetime { font-size:1.1em; margin-bottom:10px; }
button { padding:10px 15px; margin:5px; border:none; border-radius:10px; cursor:pointer;}
button:hover{opacity:0.8;}

.weather-container { display:flex; flex-wrap:wrap; gap:15px; justify-content:center; }
.weather-card { flex:1 1 250px; background:rgba(255,255,255,0.2); backdrop-filter:blur(10px); padding:15px; border-radius:15px; text-align:center; min-width:220px; position:relative; cursor:pointer; transition:0.3s; }
.weather-card:hover { transform:scale(1.05); }
.tooltip { visibility:hidden; background-color:rgba(0,0,0,0.8); color:#fff; text-align:left; border-radius:6px; padding:10px; position:absolute; z-index:1; bottom:110%; left:50%; transform:translateX(-50%); width:200px; opacity:0; transition:opacity 0.3s; }
.weather-card:hover .tooltip { visibility:visible; opacity:1; }

.chat-container { max-width:600px; margin:20px auto; border:1px solid #ccc; border-radius:10px; padding:15px; background:rgba(255,255,255,0.1); }
.chat-log { max-height:300px; overflow-y:auto; margin-bottom:10px; }
.chat-message { margin:5px 0; }
.chat-message.user { text-align:right; font-weight:bold; }
.chat-message.ai { text-align:left; color:blue; }
input[type="text"] { width:calc(100% - 100px); padding:10px; border-radius:10px; border:1px solid #ccc; }
input[type="submit"] { padding:10px 15px; border-radius:10px; border:none; background-color:#0288d1; color:white; cursor:pointer; }
</style>
</head>
<body>
<div class="container">
    <header>
        <h1>Thời tiết Việt Nam</h1>
        <div class="datetime">
            <span id="time"></span> | <span id="date"></span>
        </div>
        <button id="theme-toggle">Chế độ tối/sáng</button>
    </header>

    <main>
        <h2>Dashboard thời tiết 63 tỉnh</h2>
        <div class="weather-container" id="weather-container">
            <!-- Thời tiết 63 tỉnh sẽ hiển thị ở đây -->
        </div>

        <div class="chat-container">
            <h2>AI Chat</h2>
            <div class="chat-log" id="chat-log"></div>
            <form id="chat-form">
                <input type="text" id="chat-input" placeholder="Hỏi AI về thời tiết...">
                <input type="submit" value="Gửi">
            </form>
        </div>
    </main>
</div>

<script>
// Danh sách 63 tỉnh Việt Nam
const regions = [
    { id:'HaGiang', name:'Hà Giang' },{ id:'CaoBang', name:'Cao Bằng' },{ id:'BacKan', name:'Bắc Kạn' },
    { id:'TuyenQuang', name:'Tuyên Quang' },{ id:'LaoCai', name:'Lào Cai' },{ id:'DienBien', name:'Điện Biên' },
    { id:'LaiChau', name:'Lai Châu' },{ id:'SonLa', name:'Sơn La' },{ id:'YenBai', name:'Yên Bái' },
    { id:'HoaBinh', name:'Hoà Bình' },{ id:'ThaiNguyen', name:'Thái Nguyên' },{ id:'LangSon', name:'Lạng Sơn' },
    { id:'BacGiang', name:'Bắc Giang' },{ id:'PhuTho', name:'Phú Thọ' },{ id:'VinhPhuc', name:'Vĩnh Phúc' },
    { id:'BacNinh', name:'Bắc Ninh' },{ id:'HaNam', name:'Hà Nam' },{ id:'NamDinh', name:'Nam Định' },
    { id:'ThaiBinh', name:'Thái Bình' },{ id:'NinhBinh', name:'Ninh Bình' },{ id:'HaNoi', name:'Hà Nội' },
    { id:'HaiPhong', name:'Hải Phòng' },{ id:'QuangNinh', name:'Quảng Ninh' },{ id:'HaiDuong', name:'Hải Dương' },
    { id:'HungYen', name:'Hưng Yên' },{ id:'ThanhHoa', name:'Thanh Hóa' },{ id:'NgheAn', name:'Nghệ An' },
    { id:'HaTinh', name:'Hà Tĩnh' },{ id:'QuangBinh', name:'Quảng Bình' },{ id:'QuangTri', name:'Quảng Trị' },
    { id:'ThuaThienHue', name:'Thừa Thiên Huế' },{ id:'DaNang', name:'Đà Nẵng' },{ id:'QuangNam', name:'Quảng Nam' },
    { id:'QuangNgai', name:'Quảng Ngãi' },{ id:'BinhDinh', name:'Bình Định' },{ id:'PhuYen', name:'Phú Yên' },
    { id:'KhanhHoa', name:'Khánh Hòa' },{ id:'GiaLai', name:'Gia Lai' },{ id:'KonTum', name:'Kon Tum' },
    { id:'LamDong', name:'Lâm Đồng' },{ id:'BinhPhuoc', name:'Bình Phước' },{ id:'BinhDuong', name:'Bình Dương' },
    { id:'DongNai', name:'Đồng Nai' },{ id:'TayNinh', name:'Tây Ninh' },{ id:'BaRia', name:'Bà Rịa - Vũng Tàu' },
    { id:'HoChiMinh', name:'Hồ Chí Minh' },{ id:'LongAn', name:'Long An' },{ id:'DacLac', name:'Đắk Lắk' },
    { id:'DakNong', name:'Đắk Nông' },{ id:'TienGiang', name:'Tiền Giang' },{ id:'BenTre', name:'Bến Tre' },
    { id:'VinhLong', name:'Vĩnh Long' },{ id:'TraVinh', name:'Trà Vinh' },{ id:'SocTrang', name:'Sóc Trăng' },
    { id:'BacLieu', name:'Bạc Liêu' },{ id:'CaMau', name:'Cà Mau' },{ id:'CanTho', name:'Cần Thơ' },
    { id:'HauGiang', name:'Hậu Giang' }
];

// Hiển thị giờ & ngày
function updateTime() {
    const now = new Date();
    document.getElementById('time').textContent = now.toLocaleTimeString('vi-VN', { hour12:false });
    document.getElementById('date').textContent = now.toLocaleDateString('vi-VN', { weekday:'long', day:'numeric', month:'long', year:'numeric' });
}
setInterval(updateTime, 1000);
updateTime();

// Chế độ tối/sáng
const themeBtn = document.getElementById('theme-toggle');
const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
document.body.classList.add(prefersDark ? 'dark' : 'light');
themeBtn.addEventListener('click', ()=>{
    document.body.classList.toggle('dark');
    document.body.classList.toggle('light');
});

// OpenWeatherMap API
const apiKey = '7c134b8da09dda074780ea5d1d1847be'; // Thay bằng key thật
const weatherContainer = document.getElementById('weather-container');

async function fetchWeather(region) {
    try {
        const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${region.name},VN&units=metric&lang=vi&appid=${apiKey}`);
        const data = await res.json();
        if (data.cod !== 200) return { text: `${region.name}: Không có dữ liệu`, details: '' };
        const text = `${region.name}: ${data.main.temp}°C, ${data.weather[0].description}`;
        const details = `Độ ẩm: ${data.main.humidity}%\nGió: ${data.wind.speed} m/s\nĐộ sương: ${data.main.feels_like}°C`;
        return { text, details };
    } catch(e){
        return { text: `${region.name}: Lỗi khi lấy dữ liệu`, details:'' };
    }
}

// Hiển thị dashboard thời tiết
async function loadWeatherDashboard() {
    weatherContainer.innerHTML = 'Đang tải dữ liệu...';
    const weatherPromises = regions.map(r => fetchWeather(r));
    const results = await Promise.all(weatherPromises);
    weatherContainer.innerHTML = '';
    results.forEach(result=>{
        const card = document.createElement('div');
        card.className = 'weather-card';
        card.textContent = result.text;

        const tooltip = document.createElement('div');
        tooltip.className = 'tooltip';
        tooltip.textContent = result.details;
        card.appendChild(tooltip);

        weatherContainer.appendChild(card);
    });
}
loadWeatherDashboard();
setInterval(loadWeatherDashboard, 10*60*1000); // 10 phút 1 lần

// AI Chat
const chatForm = document.getElementById('chat-form');
const chatInput = document.getElementById('chat-input');
const chatLog = document.getElementById('chat-log');

async function getWeather(city) {
    try {
        const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city},VN&units=metric&lang=vi&appid=${apiKey}`);
        const data = await res.json();
        if (data.cod !== 200) return `Không tìm thấy dữ liệu thời tiết cho ${city}`;
        return `Thời tiết ${city} hiện tại: ${data.main.temp}°C, ${data.weather[0].description}, độ ẩm ${data.main.humidity}%, gió ${data.wind.speed} m/s, độ sương ${data.main.feels_like}°C.`;
    } catch (e) {
        return 'Có lỗi khi lấy dữ liệu thời tiết.';
    }
}

chatForm.addEventListener('submit', async e=>{
    e.preventDefault();
    const userText = chatInput.value.trim();
    if(!userText) return;
    const userMessage = document.createElement('div');
    userMessage.className = 'chat-message user';
    userMessage.textContent = userText;
    chatLog.appendChild(userMessage);

    let aiReply = '';
    const forbidden = ['bậy','sex','lồn','cặc','địt','xxx','fuck'];
    if(forbidden.some(f=>userText.toLowerCase().includes(f))){
        aiReply = 'Xin lỗi, tôi không thể trả lời câu hỏi nhạy cảm.';
    } else {
        const foundRegion = regions.find(r=>userText.toLowerCase().includes(r.name.toLowerCase()));
        if(foundRegion){
            aiReply = await getWeather(foundRegion.name);
        } else {
            aiReply = 'Xin vui lòng hỏi về thời tiết của một tỉnh ở Việt Nam.';
        }
    }

    const aiMessage = document.createElement('div');
    aiMessage.className = 'chat-message ai';
    aiMessage.textContent = aiReply;
    chatLog.appendChild(aiMessage);
    chatInput.value='';
    chatLog.scrollTop = chatLog.scrollHeight;
});
</script>
</body>
</html>
